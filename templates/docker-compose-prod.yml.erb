version: '2.1'
services:
  web:
    image: "${REGISTRY_HOST}/${REGISTRY_URI}:${TAG:-master}"
    command: bash -c "bundle exec rake assets:precompile db:migrate && bundle exec passenger start -p 3000 -b '0.0.0.0'""
    environment:
      - RAILS_ENV=production
      - RACK_ENV=production
    restart: unless-stopped
    ports:
      - "3000"
    labels:
      rap.host: ${SITE_URI}
      rap.le_host: ${SITE_URI}
      rap.le_test: true
    env_file:
      .env

<% if options[:rancher] -%>
volumes:
  uploads:
    driver: rancher-nfs
    external: true
<% end -%>
